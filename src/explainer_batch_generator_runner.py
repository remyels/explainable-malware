import os
import sys

index = sys.argv[1]
feature = sys.argv[2]
model = sys.argv[3]
explainer = sys.argv[4]

output = open("{}_{}_{}_batch_{}.sh".format(feature, model, explainer, index), "w")
output.write("#!/bin/bash\n\n")
output.write("#SBATCH --job-name=mlwexpl\n#SBATCH --account=7648020\n\n")
output.write("#SBATCH --partition=normal\n")
output.write("#SBATCH --nodes=1\n")
output.write("#SBATCH --ntasks-per-node=1\n")
output.write("#SBATCH --cpus-per-task=1\n")
output.write("#SBATCH --mem=16000\n")
output.write("#SBATCH --time=1-00:00:00\n")
output.write("#SBATCH --mail-type=ALL\n")
output.write("#SBATCH --mail-user=re135@aub.edu.lb\n\n")

output.write("module load python/3\n\n")

output.write("pip install numpy==1.18.4 --user\npip install shap==0.35.0 --user\npip install torch==1.5.0 --user\n\n")

output.write("python explanation_generator.py {} {} {} {}".format(index, feature, model, explainer))

output.close()

os.system("sbatch {}_{}_{}_batch_{}.sh".format(feature, model, explainer, index))
